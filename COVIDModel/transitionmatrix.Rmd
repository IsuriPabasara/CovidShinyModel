---
title: "R Notebook"
output: html_notebook
---

```{r}
evalFirstSystem <- function(m.g, 
                            m.icu, 
                            h.g_m, 
                            h.g_icu, 
                            h.icu_m){
  
  vec1 <- c(m.g, m.icu, 0, 0)
  vec2 <- c(h.g_icu, 1, 0, 0)
  vec3 <- c(h.g_m, h.icu_m, 1, 0)
  vec4 <- c(1, 1, 1, 1)
  
  ls <- rbind(vec1, vec2, vec3, vec4)
  
  rs <- rbind(m.g - 1, h.g_icu, h.g_m, 1)
  
  sol <- t(solve(ls, rs))
  colnames(sol) <- c('p.g_g', 'p.g_icu', 'p.g_m', 'p.g_d')
  return(sol[1,])
}
```



```{r}
evalSecondSystem <- function(m.icu, 
                             m.v, 
                             h.icu_m, 
                             h.v_m){
  vec1 <- c(m.icu, m.v, 0)
  vec2 <- c(h.icu_m, h.v_m, 1)
  vec3 <- c(1, 1, 1)
  
  ls <- rbind(vec1, vec2, vec3)
  rs <- rbind(m.v - 1, h.v_m, 1)
  
  sol <- t(solve(ls, rs))
  colnames(sol) <- c('p.v_icu', 'p.v_v', 'p.v_m')
  
  return(sol[1,])
  
}
```

```{r}
evalThirdSystem <- function(m.g, 
                            m.icu, 
                            m.v,
                            h.icu_v, 
                            h.g_m, 
                            h.icu_m, 
                            h.v_m,
                            p.g_g, 
                            p.g_icu){
  
  vec1 <- c(1, 1, 1, 1)
  vec2 <- c(m.g, m.icu, m.v, 0)
  vec3 <- c(p.g_icu * h.icu_v, h.icu_v * (1 - p.g_g), 1 - p.g_g, 0)
  vec4 <- c(h.g_m, h.icu_m, h.v_m, 1)
  
  ls <- rbind(vec1, vec2, vec3, vec4)
  rs <- c(1, m.icu - 1, (1 - p.g_g) * h.icu_v, h.icu_m)
  
  sol <- t(solve(ls, rs))
  colnames(sol) <- c('p.icu_g', 'p.icu_icu', 'p.icu_v', 'p.icu_m')
  
  return(sol[1,])
}
```


```{r}
evalThirdSystem(10, 7, 5, 0.6, 0.05, 0.2, 0.8, 0.7, 0.2)
```



```{r}
getTransition <- function(m.g, 
                          m.icu, 
                          m.v, 
                          h.g_m, 
                          h.g_icu, 
                          h.icu_m, 
                          h.icu_v,
                          h.v_m){
  
  sys1 <- evalFirstSystem(m.g, m.icu, h.g_m, h.g_icu, h.icu_m)
  sys2 <- evalSecondSystem(m.icu, m.v, h.icu_m, h.v_m)
  
  
  p.g_g <- sys1['p.g_g']
  p.g_icu <- sys1['p.g_icu']
  p.g_m <- sys1['p.g_m']
  p.g_d <- sys1['p.g_d']
  
  p.v_icu <- sys2['p.v_icu']
  p.v_v <- sys2['p.v_v']
  p.v_m <- sys2['p.v_m']
  
  sys3 <- evalThirdSystem(m.g, m.icu, m.v,h.icu_v, h.g_m, h.icu_m, h.v_m,p.g_g, p.g_icu)
  
  p.icu_g <- sys3['p.icu_g']
  p.icu_icu <- sys3['p.icu_icu']
  p.icu_v <- sys3['p.icu_v']
  p.icu_m <- sys3['p.icu_m']
  
  final.mat <- matrix(c(p.g_g, p.g_icu, 0, p.g_d, p.g_m,
                        p.icu_g, p.icu_icu, p.icu_v, 0, p.icu_m,
                        0, p.v_icu, p.v_v, 0, p.v_m,
                        0, 0, 0, 1, 0,
                        0, 0, 0, 0, 1),
                      ncol = 5, 
                      byrow = TRUE)
  
  return(final.mat)
  
}
```


```{r}
test.seq <- seq(0, 1, 0.2)

for (test.m in 1:20){
  for (test.g in 1:20){
    for(test.v in 1:20){
      for (h.g_icu in test.seq){
      for (h.icu_v in test.seq){
      for (h.g_m in test.seq){
      for (h.icu_m in test.seq){
      for (h.v_m in test.seq){

      tryCatch({
        m.g <- test.m
      m.icu <- test.g
      m.v <- test.v
      
      test.matrix <- getTransition(m.g, 
                      m.icu, 
                      m.v, 
                      h.g_m, 
                      h.g_icu, 
                      h.icu_m, 
                      h.icu_v,
                      h.v_m)
      if(all(test.matrix >= 0)){
        print(test.m)
        print(test.g)
        print(test.v)
        print(h.g_icu)
        print(h.icu_v)
        print(h.g_m)
        print(h.icu_m)
        print(h.v_m)
        stop()
      }
      },
        error=function(cond) {
        })
    }
  }
      }
      }}}}}
```


```{r}
m.g <- 12
m.icu <- 13
m.v <- 7
h.g_icu <- 0.3
h.icu_v <- 0.64
h.g_m <- 0.3
h.icu_m <- 0.5
h.v_m <- 0.8

test.matrix <- getTransition(m.g, 
                             m.icu, 
                             m.v, 
                             h.g_m, 
                             h.g_icu, 
                             h.icu_m, 
                             h.icu_v,
                             h.v_m)

test.matrix
```

